<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Danh s√°ch ƒë·ªÅ thi</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f0f2f5; /* M·ªôt m√†u x√°m r·∫•t nh·∫°t, d·ªÖ ch·ªãu cho m·∫Øt */
    }

    .page-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 3rem 0;
      border-radius: 0 0 30px 30px;
      margin-bottom: 3rem;
    }

    .page-header h1 {
      font-weight: 700;
    }

    /* T√πy ch·ªânh th·∫ª ƒë·ªÅ thi */
    .exam-card {
      border: none;
      border-radius: 15px; /* Bo g√≥c nhi·ªÅu h∆°n */
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease-in-out;
      overflow: hidden; /* ƒê·∫£m b·∫£o n·ªôi dung b√™n trong c≈©ng ƒë∆∞·ª£c bo g√≥c */
    }

    .exam-card:hover {
      transform: translateY(-8px); /* Hi·ªáu ·ª©ng nh·∫•c th·∫ª l√™n khi di chu·ªôt */
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }
    
    .card-body {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    .card-title {
        font-weight: 600;
        color: #333;
    }

    .info-list li {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }
    
    .info-list .bi {
      color: #0d6efd; /* M√†u xanh d∆∞∆°ng c·ªßa Bootstrap */
      margin-right: 10px;
      font-size: 1.1rem;
    }
    
    .btn-start-exam {
        margin-top: auto; /* Lu√¥n ƒë·∫©y n√∫t xu·ªëng cu·ªëi th·∫ª */
        font-weight: 600;
        padding: 0.75rem 1rem;
        border-radius: 10px;
    }

    .subject-badge {
      font-weight: 500;
      font-size: 0.85rem;
    }
    
    .no-exams-message {
        background-color: white;
        padding: 3rem;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    }
  </style>
</head>
<body>

  <header class="page-header text-center">
    <div class="container">
      <h1 class="display-5">üìö Danh s√°ch ƒë·ªÅ thi</h1>
      <p class="lead">Ch·ªçn m·ªôt ƒë·ªÅ thi b√™n d∆∞·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu l√†m b√†i.</p>
    </div>
  </header>

  <main class="container py-4">
    <div id="examList" class="row">
      </div>
  </main>
  
  <footer class="text-center text-muted py-4">
    <p>&copy; 2025 - H·ªá th·ªëng thi tr·ª±c tuy·∫øn</p>
  </footer>

  <script>
    async function loadExams() {
      try {
        // ‚úÖ API M·ªöI: L·∫•y ƒë·ªÅ thi theo l·ªõp h·ªçc m√† h·ªçc sinh ƒëang tham gia
        let res = await fetch("/api/exams/by-class"); 
        
        // ƒêo·∫°n code d·ª± ph√≤ng (ch·ªâ d√†nh cho gi√°o vi√™n/admin)
        if (!res.ok) {
            console.warn("L·ªói t·∫£i ƒë·ªÅ thi theo l·ªõp. Th·ª≠ t·∫£i t·∫•t c·∫£ ƒë·ªÅ thi.");
            res = await fetch("/api/exams");
            if (!res.ok) {
              throw new Error(`HTTP error! status: ${res.status}`);
            }
        }
        
        let data = await res.json();

        let html = "";
        if (data && data.length > 0) {
            data.forEach(exam => {
                // ‚úÖ HI·ªÇN TH·ªä T√äN L·ªöP (TR∆Ø·ªúNG className ƒê√É ƒê∆Ø·ª¢C TH√äM V√ÄO RESPONSE C·ª¶A SERVER)
                const classHtml = exam.className ? 
                    `<li class="info-list">
                      <i class="bi bi-person-badge-fill"></i>
                      <span><b>L·ªõp h·ªçc:</b> ${exam.className}</span>
                    </li>` : '';

                html += `
                  <div class="col-lg-4 col-md-6 col-sm-12 mb-4">
                    <div class="card exam-card h-100">
                      <div class="card-body p-4">
                        <div class="mb-3">
                            <span class="badge rounded-pill text-bg-primary subject-badge px-3 py-2">${exam.subject}</span>
                        </div>
                        <h5 class="card-title mb-3 flex-grow-1">${exam.title}</h5>
                        <ul class="list-unstyled text-secondary mb-4">
                          <li class="info-list">
                            <i class="bi bi-stopwatch-fill"></i>
                            <span><b>Th·ªùi gian:</b> ${exam.duration} ph√∫t</span>
                          </li>
                          <li class="info-list">
                            <i class="bi bi-person-check-fill"></i>
                            <span><b>GV ra ƒë·ªÅ:</b> ${exam.createdBy}</span>
                          </li>
                          ${classHtml} </ul>
                        <a href="thi.html?id=${exam._id}" class="btn btn-primary btn-start-exam w-100">
                          V√†o thi <i class="bi bi-arrow-right-circle-fill ms-2"></i>
                        </a>
                      </div>
                    </div>
                  </div>`;
            });
        } else {
            html = `
              <div class="col-12">
                <div class="no-exams-message text-center">
                  <i class="bi bi-journal-x fs-1 text-warning"></i>
                  <h3 class="mt-3">Ch∆∞a c√≥ ƒë·ªÅ thi n√†o!</h3>
                  <p class="text-muted">Vui l√≤ng quay l·∫°i sau ƒë·ªÉ ki·ªÉm tra.</p>
                </div>
              </div>
            `;
        }

        document.getElementById("examList").innerHTML = html;
      } catch (error) {
        console.error("L·ªói khi t·∫£i ƒë·ªÅ thi:", error);
        document.getElementById("examList").innerHTML = `
          <div class="col-12">
            <div class="alert alert-danger text-center">
              <i class="bi bi-exclamation-triangle-fill me-2"></i>
              ƒê√£ x·∫£y ra l·ªói khi t·∫£i danh s√°ch ƒë·ªÅ thi. Vui l√≤ng th·ª≠ l·∫°i.
            </div>
          </div>
        `;
      }
    }

    loadExams();
  </script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>